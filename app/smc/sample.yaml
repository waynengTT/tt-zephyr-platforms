sample:
  description: Tenstorrent Blackhole Chip Management Firmware
  name: bh-cmfw
common:
  timeout: 180
  platform_allow:
    - tt_blackhole@p100a/tt_blackhole/smc
    - tt_blackhole@p150a/tt_blackhole/smc
    - tt_blackhole@p300a/tt_blackhole/smc
tests:
  app.default: {}
  app.e2e-smoke-flash:
    tags: e2e-flash
    timeout: 720 # 12 minutes
    harness: pytest
    sysbuild: true
    harness_config:
      pytest_root:
        - pytest/e2e_smoke.py
      pytest_args:
        - "--dut-scope=session"
    extra_args:
      - dmc_CONFIG_DMC_RUN_SMBUS_TESTS=y
  app.recovery:
    build_only: true
    extra_overlay_confs:
      - recovery.conf
  app.recovery-flash:
    sysbuild: true
    tags: recovery
    harness: pytest
    harness_config:
      pytest_root:
        - pytest/recovery.py
      pytest_args:
        - "--dut-scope=session"
  app.vuart-bh-1x:
    tags: e2e
    depends_on: bh_1x
    harness: pytest
    harness_config:
      pytest_root:
        - pytest/vuart.py
      pytest_args:
        - "--dut-scope=session"
  app.vuart-bh-2x:
    tags: e2e
    depends_on: bh_2x
    harness: pytest
    harness_config:
      pytest_root:
        - pytest/vuart.py
      pytest_args:
        - "--dut-scope=session"
        - "--asic-id=1"
  # demonstrates pinctrl driver, macros, etc, compile
  app.e2e_smoke.pinctrl:
    tags: e2e
    build_only: true
    extra_args:
      - "EXTRA_DTC_OVERLAY_FILE=pinctrl.overlay"
    extra_overlay_confs:
      - pinctrl.conf
  app.stress-test:
    # Budget 3 hours for stress testing. Any more and we should consider reducing test coverage
    # nightly, as CI machines might not be available for PR efforts
    timeout: 10800
    tags: e2e-stress
    harness: pytest
    sysbuild: true
    extra_args:
      - dmc_CONFIG_DMC_RUN_SMBUS_TESTS=y
    harness_config:
      pytest_root:
        - pytest/e2e_stress.py
      pytest_args:
        - "--dut-scope=session"
      record:
        regex:
          - >-
            INFO: (?P<test_name>.*) completed.
            Failed (?P<fail_count>\d+)/(?P<total_tries>\d+) times.
